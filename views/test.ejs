<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="./libs/bootstrap/css/bootstrap.min.css">  
		<link rel="stylesheet" href="./libs/bootstrap/css/bootstrap-theme.css">
		<script src="//cdn.bootcss.com/codemirror/5.2.0/codemirror.min.js"></script>
		<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.2.0/codemirror.min.css">
		<script src="//cdn.bootcss.com/codemirror/5.2.0/mode/htmlmixed/htmlmixed.min.js"></script>
		<script src="//cdn.bootcss.com/codemirror/5.2.0/mode/css/css.min.js"></script>
		<script src="//cdn.bootcss.com/codemirror/5.2.0/mode/javascript/javascript.min.js"></script>
		<script src="//cdn.bootcss.com/codemirror/5.2.0/mode/xml/xml.min.js"></script>
		<script src="//cdn.bootcss.com/codemirror/5.2.0/addon/edit/closetag.min.js"></script>
		<script src="//cdn.bootcss.com/codemirror/5.2.0/addon/edit/closebrackets.min.js"></script>
	</head>

	<body>
		<style>
			@charset "utf-8";/* CSS Document */
			html {height: 100%;font-size: 62.5%;}
			body {height: 100%;margin: 0 auto;font-family:arial;font-size: 12px;font-size: 1.2rem;background: #f5f5f5;}
			img {border: none;}
			ul li {list-style-type: none;}
			ul, form, p, a, img, table, tr, td, li, dd, dt, dl, span {margin: 0;padding: 0;list-style: none;color: #333;}
			a{text-decoration: none;color: #333;outline: none;transition: 0.3s;-moz-transition: 0.3s;-o-transition: 0.3s;-webkit-transition: 0.3s;}
			input[type="submit"]{cursor: pointer;transition: 0.3s;-moz-transition: 0.3s;-o-transition: 0.3s;-webkit-transition: 0.3s;}
			p a{display: inline;}
			h1,h2,h3,h4,h5,h6 {margin: 0;padding: 0;font-weight: normal;color: #333;}
			input, textarea {font-family:arial;font-size: 12px;font-size: 1.2rem;color:#333;border: none;outline: none;padding: 0;}
			img{vertical-align: middle;}
			.head {
				height: 50px;
				background: #008080;
			}
			
			.head h1 {
				color: #fff;
			}
			
			.fl {
				float: left;
				width: 49%;
			}
			
			.fr {
				width: 49%;
				float: right;
				background: #eee;
			}
			
			#iframeResult {
				display: block;
				overflow: hidden;
				border: 0!important;
				min-width: 100px;
				width: 100%;
				min-height: 300px;
				background-color: #fff
			}
			#preview{float: right;font-size: 16px;color: #fff;background: #008080;border: 0;padding: 4px 10px;}
		</style>

		<div class="head">
			<h1><%= title %></h1></div>
		<div class="fl">
			<textarea id="textareaCode" class="form-control">
				<%= textHtml %>
			</textarea>
			<button id="preview">预览</button>
		</div>
		<div class="fr">
			<div id="iframewrapper"></div>
		</div>

	</body>

	<script>
		document.getElementById('preview').onclick = function() {
			submitTryit();
		}

		var mixedMode = {
			name: "htmlmixed",
			scriptTypes: [{
					matches: /\/x-handlebars-template|\/x-mustache/i,
					mode: null
				},
				{
					matches: /(text|application)\/(x-)?vb(a|script)/i,
					mode: "vbscript"
				}
			]
		};
		var editor = CodeMirror.fromTextArea(document.getElementById("textareaCode"), {
			mode: mixedMode,
			selectionPointer: true,
			lineNumbers: false,
			matchBrackets: true,
			indentUnit: 4,
			indentWithTabs: true,
			lineWrapping: true,
			foldGutter: true,
			gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
			extraKeys: {
				"Ctrl-Q": "autocomplete"
			}
		});

		window.addEventListener("resize", autodivheight);

		var x = 0;

		function autodivheight() {
			var winHeight = 0;
			if(window.innerHeight) {
				winHeight = window.innerHeight;
			} else if((document.body) && (document.body.clientHeight)) {
				winHeight = document.body.clientHeight;
			}
			//通过深入Document内部对body进行检测，获取浏览器窗口高度
			if(document.documentElement && document.documentElement.clientHeight) {
				winHeight = document.documentElement.clientHeight;
			}
			height = winHeight * 0.68
			editor.setSize('100%', height);
			document.getElementById("iframeResult").style.height = height + "px";
		}

		function submitTryit() {
			var text = editor.getValue();
			var patternHtml = /<html[^>]*>((.|[\n\r])*)<\/html>/im
			var patternHead = /<head[^>]*>((.|[\n\r])*)<\/head>/im
			var array_matches_head = patternHead.exec(text);
			var patternBody = /<body[^>]*>((.|[\n\r])*)<\/body>/im;

			var array_matches_body = patternBody.exec(text);
			var basepath_flag = 1;
			var basepath = '';
			if(basepath_flag) {
				basepath = '<base href="http://192.168.0.6:8080/hifactory/" target="_blank">';
			}
			if(array_matches_head) {
				text = text.replace('<head>', '<head>' + basepath);
			} else if(patternHtml) {
				text = text.replace('<html>', '<head>' + basepath + '</head>');
			} else if(array_matches_body) {
				text = text.replace('<body>', '<body>' + basepath);
			} else {
				text = basepath + text;
			}
			var ifr = document.createElement("iframe");
			ifr.setAttribute("frameborder", "0");
			ifr.setAttribute("id", "iframeResult");
			document.getElementById("iframewrapper").innerHTML = "";
			document.getElementById("iframewrapper").appendChild(ifr);

			var ifrw = (ifr.contentWindow) ? ifr.contentWindow : (ifr.contentDocument.document) ? ifr.contentDocument.document : ifr.contentDocument;
			ifrw.document.open();
			ifrw.document.write(text);
			ifrw.document.close();
			autodivheight();
		}
		submitTryit();
		autodivheight();
	</script>
	<!-- 标准的按钮 -->
    <button type="button" class="btn btn-default">默认按钮</button>
    <!-- 提供额外的视觉效果，标识一组按钮中的原始动作 -->
    <button type="button" class="btn btn-primary">原始按钮</button>
    <!-- 表示一个成功的或积极的动作 -->
    <button type="button" class="btn btn-success">成功按钮</button>
    <!-- 信息警告消息的上下文按钮 -->
    <button type="button" class="btn btn-info">信息按钮</button>
    <!-- 表示应谨慎采取的动作 -->
    <button type="button" class="btn btn-warning">警告1按钮</button>
    <!-- 表示一个危险的或潜在的负面动作 -->
    <button type="button" class="btn btn-danger">危险按钮</button>
    <!-- 并不强调是一个按钮，看起来像一个链接，但同时保持按钮的行为 -->
	<button type="button" class="btn btn-link">链接按钮2</button>
	
	<script src="./libs/jquery.min.js"></script>
	<script src="./libs/bootstrap/js/bootstrap.min.js"></script>
</html>